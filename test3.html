<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Employee Equipment Inventory</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body{font-family:Arial;background:#f4f6f8;display:flex;justify-content:center;padding:30px}
.card{width:880px;background:#fff;border-radius:10px;padding:20px;box-shadow:0 6px 22px rgba(15,23,42,0.08)}
.btn{background:#0b69ff;color:#fff;padding:6px 10px;border-radius:6px;border:0;cursor:pointer;margin:2px}
.btn.secondary{background:#e6eefc;color:#0b69ff}
.icon{transition:transform .3s}
.rotated{transform:rotate(90deg)}
.employee,.equip-item{border:1px solid #e6e9ef;border-radius:8px;padding:10px;margin-top:10px}
.employee-header,.equip-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer}
.employee-details,.equip-details{display:none;margin-top:8px}
input,select{width:100%;padding:6px;margin-top:6px;border:1px solid #d6dbe8;border-radius:6px}
.small{font-size:12px;color:#55617a}
</style>
</head>
<body>
<div class="card">
  <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
    <button id="downloadBtn" class="btn">â¬‡ Download Excel</button>
    <button id="addEmployeeBtn" class="btn secondary">+ Add Employee</button>
  </div>
  <div id="employeesContainer"></div>
</div>

<script>
const employees = [];
let equipmentTypes = ["PC","ECRAN","CLAVIER SOURIS","CASQUE","PHONE","FIX","SIM"];

function renderEmployees(){
  const c=document.getElementById('employeesContainer');c.innerHTML='';
  employees.forEach((emp,ei)=>{
    const empDiv=document.createElement('div');
    empDiv.className='employee';
    empDiv.innerHTML=`
      <div class="employee-header">
        <div><b>${emp.name||'New Employee'}</b></div>
        <div>
          <button class="btn secondary toggleEmp">â–¶</button>
          <button class="btn secondary delEmp">ðŸ—‘</button>
        </div>
      </div>
      <div class="employee-details">
        <label>Name</label>
        <input value="${emp.name||''}" class="empName"/>
        <div class="equip-list"></div>
        <button class="btn addEquip">+ Add Equipment</button>
      </div>`;
    const details=empDiv.querySelector('.employee-details');
    const toggle=empDiv.querySelector('.toggleEmp');
    const del=empDiv.querySelector('.delEmp');
    const input=empDiv.querySelector('.empName');
    const equipList=empDiv.querySelector('.equip-list');
    const addEquip=empDiv.querySelector('.addEquip');

    toggle.onclick=()=>{
      document.querySelectorAll('.employee-details').forEach(d=>d.style.display='none');
      document.querySelectorAll('.toggleEmp').forEach(i=>i.classList.remove('rotated'));
      details.style.display='block';
      toggle.classList.add('rotated');
    };
    del.onclick=()=>{employees.splice(ei,1);renderEmployees();};
    input.oninput=e=>{emp.name=e.target.value;renderEmployees();};
    addEquip.onclick=()=>{emp.equipments.push({type:"PC",serial:"",date:""});renderEmployees();};
    emp.equipments.forEach((eq,qi)=>{
      const e=document.createElement('div');
      const shortSN=(eq.serial||'').slice(-3);
      e.className='equip-item';
      e.innerHTML=`
        <div class="equip-header">
          <div>${eq.type} - ${shortSN||'---'}</div>
          <div>
            <button class="btn secondary toggleEq">â–¶</button>
            <button class="btn secondary delEq">ðŸ—‘</button>
          </div>
        </div>
        <div class="equip-details">
          <label>Type</label>
          <select class="eqType">${equipmentTypes.map(t=>`<option ${t==eq.type?'selected':''}>${t}</option>`).join('')}</select>
          <label>Serial Number</label>
          <input value="${eq.serial||''}" class="eqSerial"/>
          <label>Received Date</label>
          <input type="date" value="${eq.date||''}" class="eqDate"/>
        </div>`;
      const eqDetails=e.querySelector('.equip-details');
      const tBtn=e.querySelector('.toggleEq');
      const dBtn=e.querySelector('.delEq');
      const sType=e.querySelector('.eqType');
      const sSerial=e.querySelector('.eqSerial');
      const sDate=e.querySelector('.eqDate');
      tBtn.onclick=()=>{
        equipList.querySelectorAll('.equip-details').forEach(d=>d.style.display='none');
        equipList.querySelectorAll('.toggleEq').forEach(i=>i.classList.remove('rotated'));
        eqDetails.style.display='block';
        tBtn.classList.add('rotated');
      };
      dBtn.onclick=()=>{emp.equipments.splice(qi,1);renderEmployees();};
      sType.onchange=e=>{eq.type=e.target.value;renderEmployees();};
      sSerial.oninput=e=>{eq.serial=e.target.value;renderEmployees();};
      sDate.onchange=e=>{eq.date=e.target.value;};
      equipList.appendChild(e);
    });
    c.appendChild(empDiv);
  });
}

document.getElementById('addEmployeeBtn').onclick=()=>{employees.push({name:'',equipments:[]});renderEmployees();};

document.getElementById('downloadBtn').onclick=()=>{
  const rows=[];
  employees.forEach(emp=>{
    emp.equipments.forEach(eq=>{
      if(emp.name&&eq.type&&eq.serial&&eq.date)
        rows.push({
          "Serial Number":eq.serial,
          "Equipment Name":eq.type,
          "Employee Name":emp.name,
          "Received Date":eq.date
        });
    });
  });
  if(!rows.length)return alert("No data to export");
  const ws=XLSX.utils.json_to_sheet(rows);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,'Inventory');
  XLSX.writeFile(wb,'Employee_Inventory.xlsx');
};

renderEmployees();
</script>
</body>
</html>